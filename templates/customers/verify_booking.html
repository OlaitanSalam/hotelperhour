{% extends 'base2.html' %}
{% load humanize %}
{% block title %}Verify Booking{% endblock %}

{% block content %}
<div class="container mt-5 mb-5 pb-5">
    <h2>Verify Booking</h2>

    <!-- Error Message -->
    {% if error %}
        <div class="alert alert-danger" role="alert">
            {{ error }}
        </div>
    {% endif %}

    <!-- Verification Form -->
    {% if not booking %}
    <form method="post" class="mt-4">
        {% csrf_token %}
        <div class="mb-3">
            <label for="reference" class="form-label">Booking Reference</label>
            <input type="text" name="reference" id="reference" class="form-control" required placeholder="e.g., HPH-123456">
        </div>
        <div class="mb-3">
            <label for="email" class="form-label">Email Address</label>
            <input type="email" name="email" id="email" class="form-control" required placeholder="you@example.com">
        </div>
        <button type="submit" class="btn btn-primary">Verify</button>
    </form>
    {% endif %}

    <!-- Booking Details -->
    {% if booking %}
    <div class="mt-4 card">
        <div class="card-body">
            <h4 class="card-title">Booking Details</h4>

            <p><strong>Reference:</strong> {{ booking.booking_reference }}</p>
            <p><strong>Hotel:</strong> {{ booking.room.hotel.name }}</p>
            <p><strong>Room:</strong> {{ booking.room.room_type }}{% if booking.room.name %} ({{ booking.room.name }}){% endif %}</p>
            <p><strong>Check-in:</strong> {{ booking.check_in|date:"M d, Y - g:i A" }}</p>
            <p><strong>Check-out:</strong> {{ booking.check_out|date:"M d, Y - g:i A" }}</p>

            <p><strong>Duration:</strong>
                <span class="badge bg-info text-dark">{{ package_label }}</span>
            </p>

            <p><strong>Room Cost:</strong> ₦{{ base_room_cost|floatformat:2|intcomma }}</p>

            {% if booking.discount_applied > 0 %}
                <p><strong>Discount Applied:</strong>
                    -₦{{ booking.discount_applied|floatformat:2|intcomma }}
                    <small class="text-muted">({{ discount_percentage|floatformat:1 }}% off)</small>
                </p>
                <p><strong>Room Cost (after discount):</strong> ₦{{ final_room_cost|floatformat:2|intcomma }}</p>
            {% else %}
                <p><strong>Discount:</strong> None</p>
            {% endif %}

            {% if extras %}
                <p><strong>Extras:</strong></p>
                <ul class="list-unstyled ms-3">
                    {% for extra in extras %}
                    <li>• {{ extra.name }} — ₦{{ extra.price|floatformat:2|intcomma }}</li>
                    {% endfor %}
                </ul>
                <p><strong>Extras Total:</strong> ₦{{ extras_total|floatformat:2|intcomma }}</p>
            {% endif %}

            <hr>

            <p><strong>Total Amount Paid:</strong> 
                <span class="text-success">₦{{ booking.total_amount|floatformat:2|intcomma }}</span>
            </p>

            <p><strong>Status:</strong>
                {% if booking.is_paid %}
                    <span class="text-success">Paid</span>
                {% else %}
                    <span class="text-warning">Payment Pending</span>
                {% endif %}
            </p>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
