{% extends 'base2.html' %}
{% load static %}

{% block title %}{{ hotel.get_public_name }}{% endblock %}

{% block content %}
<!-- Toast Notifications - Place at the beginning of content -->
<div class="toast-container position-fixed bottom-0 start-0 p-3">
  <div id="successToast" class="toast align-items-center text-white bg-success border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body">Thank you for your review!</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

<div class="toast-container position-fixed bottom-0 start-0 p-3">
  <div id="errorToast" class="toast align-items-center text-white bg-danger border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body" id="errorToastMessage">There was an error submitting your review.</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>




<!-- ======= HERO + GRID / CAROUSEL SECTION ======= -->
<div class="container mt-4">

  <!-- ======= Hotel Info (Above Grid - Unified Styling) ======= -->
<div class="card shadow-sm border-0 mb-4" style="border-radius: 10px; background-color: #f8f9fa;">
  <div class="card-body py-3 px-4">
    <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between">
      <div class="hotel-info-text">
        <h1 class="fw-bold mb-2" style="font-size: 1.8rem; color: #121643;">{{ hotel.get_public_name }}</h1>
        <div class="d-flex align-items-center mb-2">
          <div class="me-2">
            {% for i in "12345"|make_list %}
              {% if hotel.average_rating|floatformat:0 >= i|add:"0" %}
                <i class="fas fa-star text-warning"></i>
              {% else %}
                <i class="far fa-star text-warning"></i>
              {% endif %}
            {% endfor %}
          </div>
          <small class="text-muted">{{ hotel.average_rating|floatformat:1 }} ({{ hotel.review_count }} reviews)</small>
        </div>
        <p class="text-muted mb-0">
          <i class="fas fa-map-marker-alt text-danger me-2"></i>
          {{ hotel.suburb|default:hotel.city }}
        </p>
      </div>
    </div>
  </div>
</div>


  <!-- ======= Desktop / Tablet View (Dynamic Grid) ======= -->
{% with count=hotel_images.count %}
  {% if count == 0 %}
    <!-- No images -->
    <div class="card border-0 shadow-sm">
      <img src="{{ hotel.image.url }}" alt="{{ hotel.name }}" class="w-100 rounded-3" style="border-radius:8px; height:420px;object-fit:cover;">
    </div>

  {% elif count == 1 %}
    <!-- Single image fills full width -->
    <div class="card border-0 shadow-sm">
      <img src="{{ hotel_images.0.image.url }}" alt="{{ hotel.name }}" class="w-100 rounded-3" style="border-radius:8px; height:420px;object-fit:cover;">
    </div>

  {% elif count == 2 %}
    <!-- Two side-by-side -->
    <div class="row g-3">
      {% for img in hotel_images %}
        <div class="col-6">
          <div class="card border-0 shadow-sm">
            <img src="{{ img.image.url }}" alt="{{ img.alt_text|default:hotel.name }}" class="w-100 rounded-3" style="border-radius:8px;height:420px;object-fit:cover;">
          </div>
        </div>
      {% endfor %}
    </div>

  {% elif count == 3 %}
  <!-- 3-image layout: 1 big left, 2 stacked right -->
  <div class="row g-3 desktop-grid-section">
    <div class="col-lg-6">
      <img src="{{ hotel_images.0.image.url }}" alt="{{ hotel.name }}"
           class="hotel-grid-img" style="height:420px;">
    </div>
    <div class="col-lg-6">
      <div class="row g-3">
        <div class="col-12">
          <img src="{{ hotel_images.1.image.url }}" alt="{{ hotel.name }}"
               class="hotel-grid-img" style="height:205px;">
        </div>
        <div class="col-12">
          <img src="{{ hotel_images.2.image.url }}" alt="{{ hotel.name }}"
               class="hotel-grid-img" style="height:205px;">
        </div>
      </div>
    </div>
  </div>


  {% elif count >= 4 %}
    <!-- Standard grid (your original layout) -->
    <div class="row g-3 align-items-start">
      <div class="col-lg-6">
        <img src="{{ hotel_images.0.image.url }}" class="w-100 rounded-3" style="border-radius:8px; height:420px;object-fit:cover;">
      </div>
      <div class="col-lg-6">
        <div class="row g-3">
          {% for img in hotel_images|slice:"1:5" %}
            <div class="col-6">
              <img src="{{ img.image.url }}" class="w-100 rounded-3" style="border-radius:8px; height:205px;object-fit:cover;">
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}
{% endwith %}


  <!-- ======= Small Thumbnails (desktop only) ======= -->
  <div class="row mt-3 g-2 d-none d-md-flex">
    {% with total=hotel_images.count %}
      {% for img in hotel_images|slice:":6" %}
        <div class="col-6 col-sm-4 col-md-2">
          <div class="position-relative gallery-thumb" role="button"
               data-bs-toggle="modal" data-bs-target="#photosModal" data-index="{{ forloop.counter0 }}">
            <img src="{{ img.image.url }}" alt="{{ img.alt_text|default:hotel.name }}"
                 class="img-fluid thumb-img" loading="lazy">
            {% if forloop.last and total > 6 %}
              <div class="overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center"
                   style="background: rgba(0,0,0,0.45); color:#fff;">
                <div class="text-center">
                  <div class="h4 mb-0">+{{ total|add:-6 }}</div>
                  <small>more</small>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    {% endwith %}
  </div>

  <!-- ======= Mobile Carousel - FIXED ======= -->
<div class="d-md-none mt-3">
  <div class="card border-0 shadow-sm" style="border-radius:8px; overflow:hidden;">
    {% with count=hotel_images.count %}
      {% if count > 1 %}
        <!-- Carousel for multiple images -->
        <div id="hotelMobileCarousel" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            {% for img in hotel_images %}
              <div class="carousel-item {% if forloop.first %}active{% endif %}">
                <img src="{{ img.image.url }}" alt="{{ img.alt_text|default:hotel.name }}"
                     class="d-block w-100" style="height:320px;object-fit:cover;" loading="lazy">
              </div>
            {% endfor %}
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#hotelMobileCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon bg-dark rounded-circle"></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#hotelMobileCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon bg-dark rounded-circle"></span>
          </button>
          <div class="carousel-caption position-absolute bottom-0 end-0 p-2 bg-dark bg-opacity-50 text-white rounded-start">
            <small id="carousel-counter">1 / {{ count }}</small>
          </div>
        </div>
      {% else %}
        <!-- Single image display -->
        <div class="single-image-container">
          {% if count == 1 %}
            <img src="{{ hotel_images.0.image.url }}" alt="{{ hotel_images.0.alt_text|default:hotel.name }}"
                 class="w-100" style="height:320px;object-fit:cover;" loading="lazy">
          
          {% endif %}
        </div>
      {% endif %}
    {% endwith %}
  </div>
</div>

<!-- ======= SEE MORE MODAL ======= -->
<div class="modal fade" id="photosModal" tabindex="-1" aria-labelledby="photosModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content bg-dark">
      <div class="modal-body p-0 position-relative">
        <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3" data-bs-dismiss="modal" aria-label="Close"></button>
        <div id="hotelPhotosCarousel" class="carousel slide" data-bs-ride="false">
          <div class="carousel-inner">
            {% for img in hotel_images %}
              <div class="carousel-item {% if forloop.first %}active{% endif %}">
                <div class="d-flex justify-content-center align-items-center" style="height: 80vh; background-color: #000;">
                  <img src="{{ img.image.url }}" alt="{{ img.alt_text|default:hotel.name }}" 
                       class="img-fluid rounded shadow-lg"
                       style="max-height: 75vh; width: auto; object-fit: contain;">
                </div>
              </div>
            {% empty %}
              <div class="carousel-item active">
                <div class="d-flex justify-content-center align-items-center" style="height: 80vh; background-color: #000;">
                  <img src="{% static 'images/default_hotel.webp' %}" alt="No image available" 
                       class="img-fluid rounded shadow-lg"
                       style="max-height: 75vh; width: auto; object-fit: contain;">
                </div>
              </div>
            {% endfor %}
          </div>

          <!-- Carousel Controls -->
          <button class="carousel-control-prev" type="button" data-bs-target="#hotelPhotosCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon bg-dark rounded-circle p-3"></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#hotelPhotosCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon bg-dark rounded-circle p-3"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>



<div class="container mt-4">
    <div class="row">

      <!-- Tabbed Navigation / In-Page Menu -->
<nav class="navbar navbar-expand-lg navbar-light bg-light position-sticky top-0 z-3 shadow-sm" style="margin: 0 auto; max-width: 1140px; padding-bottom: 1rem;">  <!-- Added padding-bottom -->
    <div class="container-fluid">
        <ul class="navbar-nav ms-0">  <!-- Removed mx-auto to align left, added ms-0 for margin-start -->
            <li class="nav-item">
                <a class="nav-link active" href="#rooms-section" data-bs-toggle="pill">Rooms</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="#about-section" data-bs-toggle="pill">About</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#reviews-section" data-bs-toggle="pill">Reviews</a>
            </li>
        </ul>
    </div>
</nav>

<div class="container mt-4">
    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-9 mb-4">
            
            
            <!-- Rooms Section with Filters and Grid -->
            <div class="rooms-section">
                <!-- Rooms Header with Controls -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h3 class="mb-1" style="font-size: 1.75rem; font-weight: 600;"><i class="fas fa-bed me-2 text-primary"></i>Available Rooms</h3>
                        <small class="text-muted">
                            <span id="rooms-count">{{ hotel.rooms.all|length }}</span> room{{ hotel.rooms.all|length|pluralize }} available
                        </small>
                    </div>
                    
                    <!-- View Toggle -->
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-secondary btn-sm active" id="grid-view" onclick="toggleView('grid')">
                            <i class="fas fa-th"></i>
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="list-view" onclick="toggleView('list')">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Filters -->
                <div class="card mb-4">
                    <div class="card-body py-3">
                        <div class="row align-items-center">
                            <div class="col-md-4 mb-2 mb-md-0">
                                <select class="form-select form-select-sm" id="capacity-filter">
                                    <option value="">Any Capacity</option>
                                    <option value="1">1 Guest</option>
                                    <option value="2">2 Guests</option>
                                    <option value="3">3 Guests</option>
                                    <option value="4">4+ Guests</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-2 mb-md-0">
                                <select class="form-select form-select-sm" id="price-filter">
                                    <option value="">Any Price</option>
                                    <option value="0-3000">₦0 - ₦3,000</option>
                                    <option value="3000-5000">₦3,000 - ₦5,000</option>
                                    <option value="5000-10000">₦5,000 - ₦10,000</option>
                                    <option value="10000+">₦10,000+</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <select class="form-select form-select-sm" id="availability-filter">
                                    <option value="">All Rooms</option>
                                    <option value="available">Available Only</option>
                                    <option value="unavailable">Unavailable Only</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Rooms Grid/List Container -->
                <div id="rooms-container" class="rooms-grid">
                    {% for room in hotel.rooms.all %}
                        <div class="room-item" 
                             data-room-type="{{ room.room_type|lower }}" 
                             data-capacity="{{ room.capacity }}" 
                             data-price="{{ room.price_per_hour }}"
                             data-availability="{% if room.is_available %}available{% else %}unavailable{% endif %}">
                            
                            <!-- Grid View Card -->
                            <div class="room-card-grid">
                                <div class="room-image-container">
                                    {% if room.image %}
                                        <img src="{{ room.image.url }}" alt="{{ room.room_type }}" class="room-image">
                                    {% else %}
                                        <div class="room-image-placeholder">
                                            <i class="fas fa-bed fa-2x text-muted"></i>
                                        </div>
                                    {% endif %}
                                    
                                    <!-- Availability Badge -->
                                    <div class="availability-badge">
                                        <span class="badge {% if room.is_available %}bg-success{% else %}bg-secondary{% endif %}">
                                            {% if room.is_available %}Available{% else %}Booked{% endif %}
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="room-content p-3">
                                    <h6 class="room-title mb-2">{{ room.room_type }}</h6>
                                    
                                    <div class="room-details mb-2">
                                        <small class="text-muted">
                                            <i class="fas fa-users me-1"></i>{{ room.capacity }} guest{{ room.capacity|pluralize }}
                                        </small>
                                    </div>
                                    
                                    <p class="room-description">{{ room.description }}</p>
                                    
                                    
                                    
                                    <!-- Price and Booking -->
                                    <div class="room-footer">
                                        <div class="price-section mb-2">
                                            <span class="price">₦{{ room.price_per_hour|floatformat:0 }}</span>
                                            <span class="price-unit">/hour</span>
                                        </div>
                                        
                                        {% if room.is_available %}
                                            <a href="{% url 'book_room' room.id %}" class="btn btn-primary btn-sm w-100">
                                                <i class="fas fa-calendar-check me-1"></i>Book Now
                                            </a>
                                        {% else %}
                                            <button class="btn btn-secondary btn-sm w-100" disabled>
                                                <i class="fas fa-ban me-1"></i>Not Available
                                            </button>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- List View Card (hidden by default) -->
                            <div class="room-card-list" style="display: none;">
                                <div class="row g-0">
                                    <div class="col-md-3">
                                        <div class="room-image-container-list">
                                            {% if room.image %}
                                                <img src="{{ room.image.url }}" alt="{{ room.room_type }}" class="room-image">
                                            {% else %}
                                                <div class="room-image-placeholder">
                                                    <i class="fas fa-bed fa-2x text-muted"></i>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-md-6 p-3">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <h6 class="mb-0">{{ room.room_type }}</h6>
                                            <span class="badge {% if room.is_available %}bg-success{% else %}bg-secondary{% endif %}">
                                                {% if room.is_available %}Available{% else %}Booked{% endif %}
                                            </span>
                                        </div>
                                        
                                        <div class="mb-2">
                                            <small class="text-muted">
                                                <i class="fas fa-users me-1"></i>{{ room.capacity }} guest{{ room.capacity|pluralize }}
                                            </small>
                                        </div>
                                        
                                        <p class="mb-2">{{ room.description|truncatewords:15 }}</p>
                                        
                                        
                                    </div>
                                    <div class="col-md-3 p-3 bg-light d-flex flex-column justify-content-center">
                                        <div class="text-center mb-2">
                                            <span class="price">₦{{ room.price_per_hour|floatformat:0 }}</span>
                                            <span class="price-unit d-block">/hour</span>
                                        </div>
                                        
                                        {% if room.is_available %}
                                            <a href="{% url 'book_room' room.id %}" class="btn btn-primary btn-sm">
                                                <i class="fas fa-calendar-check me-1"></i>Book Now
                                            </a>
                                        {% else %}
                                            <button class="btn btn-secondary btn-sm" disabled>
                                                <i class="fas fa-ban me-1"></i>Not Available
                                            </button>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% empty %}
                        <div class="col-12">
                            <div class="alert alert-info text-center">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>No rooms available</strong><br>
                                <small>Please check back later.</small>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <!-- No Results Message -->
                <div id="no-results" class="alert alert-warning text-center" style="display: none;">
                    <i class="fas fa-search me-2"></i>
                    <strong>No rooms match your filters</strong><br>
                    <small>Try adjusting your search criteria</small>
                </div>
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-3">
            <!-- Room Summary -->
            <div class="card shadow-sm sticky-top" style="top: 80px;">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Room Summary</h6>
                </div>
                <div class="card-body">
                    <div class="summary-item">
                        <span class="summary-label">Total Rooms:</span>
                        <span class="summary-value">{{ hotel.rooms.all|length }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Available:</span>
                        <span class="summary-value text-success">{{ hotel.rooms.all|length }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    </div>





<section id="about-section" class="py-3">
    <div class="container">
        <div class="card" style="border-radius: 8px;"> <!-- Matches navbar-light bg-light style -->
            <div class="card-header" style="border: none; padding:1.5rem; padding-bottom: 4px;">
                <h2 class="mb-0" style="font-size: 2rem; font-weight: 600;">About</h2>
            </div>
            <div class="card-body" style="padding: 1.5rem;">
                <!-- Hotel Description -->
                <div class="mb-4">
    <h4 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Description</h4>
    <div class="description-content">
        <p class="text-muted" id="description-text">{{ hotel.description|safe|truncatewords:50 }}</p>
        {% if hotel.description|wordcount > 50 %}
            <p class="text-muted d-none" id="description-full">{{ hotel.description|safe }}</p>
            <button class="btn btn-link p-0 see-more brand-link" data-target="description">See More</button>

        {% endif %}
    </div>
</div>

                <!-- Amenities -->
                <div class="mb-4">
  <h4 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Amenities</h4>
  <div class="amenities-content">
    <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
      {% for amenity in hotel.amenities.all %}
        <div class="col">
          <div class="d-flex align-items-center">
            <i class="{{ amenity.icon_class|default:'fas fa-check' }} me-2 text-primary"></i>
            <span class="text-dark">{{ amenity.name }}</span>
          </div>
        </div>
      {% empty %}
        <p class="text-muted">No amenities listed.</p>
      {% endfor %}
    </div>
  </div>
</div>



                <!-- Policies -->
                <div>
                    <h4 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Policies</h4>
                    <div class="policies-content">
                        <ul class="list-unstyled">
                            {% for policy in hotel.policies.all %}
                                <li class="mb-2">- {{ policy.policy_text }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>



<section id="reviews-section" class="py-3">
    <div class="container">
        <div class="card bg-light" style="border: none; border-radius: 8px;">
            <div class="card-header bg-light" style="border: none; padding:1.5rem; padding-bottom: 4px;">
                <h2 class="mb-0" style="color: #2c3e50; font-size: 2rem; font-weight: 600;">Reviews ({{ hotel.review_count }})</h2>
            </div>
            <div class="card-body bg-light p-4">
                <!-- Rating Breakdown -->
                <div class="mb-4">
                    
                    <div class="rating-distribution" >
                        {% for rating, count in rating_breakdown.items %}
<div class="mb-3">
  <div class="d-flex justify-content-between mb-1">
    <span class="fw-semibold">{{ rating }} star{{ rating|pluralize }}</span>
    <span class="text-muted">{{ count.value }}</span>
  </div>
  <div class="progress" style="height: 12px; border-radius: 8px; overflow: hidden;">
    <div class="progress-bar 
      {% if rating == 5 %}bg-success
      {% elif rating == 4 %}bg-info
      {% elif rating == 3 %}bg-warning
      {% elif rating == 2 %}bg-orange
      {% else %}bg-danger{% endif %}" 
      role="progressbar" 
      style="width: {{ count.percent }}%;">
    </div>
  </div>
</div>
{% endfor %}

                    </div>
                </div>

                <!-- Reviews List -->
                <div class="reviews-list mb-4">
                    {% for review in reviews %}
                        <div class="review-item border rounded p-3 mb-3 bg-white">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <h5 class="fw-semibold mb-0">{{ review.name }}</h5>
                                <span class="ms-2 badge" 
                                  style="background-color: rgb(48, 152, 48); color: #fff; min-width: 48px; height: 32px; display: inline-flex; align-items: center; justify-content: center; font-size: 0.9rem; border-radius: 16px; padding: 0 10px;">
                                  {{ review.rating }}<i class="fas fa-star ms-1"></i>
                                </span>

                                
                            </div>
                            <small class="text-muted d-block mb-2">{{ review.created_at|date:"M d, Y" }}</small>
                            
                            <p class="text-muted review-text-short">{{ review.review_text|truncatewords:30 }}</p>
                            {% if review.review_text|wordcount > 30 %}
                                <button class="btn btn-link p-0 see-more-review" data-full-text="{{ review.review_text|safe }}">See More</button>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>

                <!-- See More Reviews Button (if more than 5 initial) -->
                {% if hotel.review_count > 5 %}
                    <div class="text-center">
                        <button class="btn btn-outline-primary " id="see-more-reviews">See More Reviews</button>
                    </div>
                {% endif %}

                <!-- Leave a Review Button (conditional) -->
                <div class="text-center mt-4">
                    {% if user.is_authenticated and not user.is_hotel_owner %}
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#reviewModal">Leave a Review</button>
                    {% elif not user.is_authenticated %}
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#loginModal">Leave a Review</button>
                    {% else %}
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ownerModal">Leave a Review</button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Review Modal (for authenticated non-owners) -->
<div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reviewModalLabel">Leave a Review</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="{% url 'hotel_detail' hotel.slug %}">
                    {% csrf_token %}
                    {{ review_form.non_field_errors }}
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        {{ review_form.name }}
                        {{ review_form.name.errors }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        {{ review_form.email }}
                        {{ review_form.email.errors }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Rating</label>
                        {{ review_form.rating }}
                        {{ review_form.rating.errors }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Review</label>
                        {{ review_form.review_text }}
                        {{ review_form.review_text.errors }}
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Review</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Login Modal (for non-authenticated) -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">Login Required</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <p>Please log in to leave a review.</p>
                <a href="{% url 'customer_login' %}" class="btn btn-primary">Log In</a>
            </div>
        </div>
    </div>
</div>

<!-- Owner Modal (for hotel owners) -->
<div class="modal fade" id="ownerModal" tabindex="-1" aria-labelledby="ownerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ownerModalLabel">Review Not Allowed</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <p>Only guests are allowed to drop reviews.</p>
            </div>
        </div>
    </div>
</div>
</div>
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


<style>

    /* Standardized Heading Styles */
h1, h2, h3, h4 {
    color: #2c3e50;
    line-height: 1.2;
}
h1 {
    font-size: 2.5rem;
    font-weight: 700;
}
h2 {
    font-size: 2rem;
    font-weight: 600;
}
h3 {
    font-size: 1.75rem;
    font-weight: 600;
}
h4 {
    font-size: 1.25rem;
    font-weight: 500;
}
.text-muted {
    color: #6c757d !important;
    font-size: 0.95rem;
}
    /* Hero section styles */
    .hotel-hero-image {
        height: 400px;
        background-size: cover;
        background-position: center;
        position: relative;
    }
    
    .hotel-hero-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.7));
    }
    
    .hotel-hero-content {
        padding: 2rem 0;
        position: absolute;
        bottom: 0;
        width: 100%;
    }

    .content-section {
        margin-left: 0;  /* Remove centering, align left */
        max-width: 1140px;  /* Match navigation width */
        margin: 0 auto 2rem auto;  /* Left margin 0, right auto, bottom padding 2rem */
        padding-top: 1rem;  /* Space after navigation */
    }
    .navbar-sticky + .content-section {
        padding-top: 4rem;  /* Extra padding when navigation is sticky to avoid overlap */
    }
    @media (max-width: 991.98px) {
        .navbar-nav {
            margin-left: 0 !important;  /* Ensure left alignment on mobile */
        }
    }
    
    /* Rooms Grid Layout */
    .rooms-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
    }
    
    .rooms-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    /* Room Card Styles */
    .room-card-grid {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        height: 100%;
        display: flex;
        flex-direction: column;
    }
    
    .room-card-grid:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .room-card-list {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        margin-bottom: 1rem;
    }
    
    .room-card-list:hover {
        box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    }
    
    /* Room Image Styles */
    .room-image-container {
        height: 200px;
        position: relative;
        overflow: hidden;
    }
    
    .room-image-container-list {
        height: 150px;
        overflow: hidden;
    }
    
    .room-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .room-image-placeholder {
        width: 100%;
        height: 100%;
        background: #f8f9fa;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .availability-badge {
        position: absolute;
        top: 10px;
        right: 10px;
    }
    
    /* Room Content */
    .room-content {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    
    .room-title {
        font-weight: 600;
        color: #2c3e50;
    }
    
    .room-description {
        font-size: 0.875rem;
        color: #6c757d;
        flex: 1;
    }
    
    /* Amenities */
    .amenities {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }
    
    .amenity-badge {
        background: #f8f9fa;
        color: #6c757d;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
    }
    
    /* Price Styles */
    .price {
        font-size: 1.25rem;
        font-weight: 700;
        color: #28a745;
    }
    
    .price-unit {
        font-size: 0.875rem;
        color: #6c757d;
    }
    
    /* Summary Styles */
    .summary-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
        border-bottom: 1px solid #f1f3f4;
    }
    
    .summary-item:last-child {
        border-bottom: none;
    }
    
    .summary-label {
        font-size: 0.875rem;
        color: #6c757d;
    }
    
    .summary-value {
        font-weight: 600;
    }
    
    /* Enhanced Reviews Section Styles */
    #hotel-reviews {
        background: linear-gradient(180deg, #e9ecef 0%, #ffffff 100%);

        border-radius: 0;
    }
    
    #hotel-reviews h2 {
        color: #121643;
        font-size: 2.2rem;
        font-weight: 700;
        position: relative;
        margin-bottom: 2.5rem;
    }
    
    #hotel-reviews h2:after {
        content: '';
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 3px;
        background: #ffd700;
        border-radius: 2px;
    }
    
    /* Smaller, completely white review cards */
    /* Same style as homepage */
.review-card {
    flex: 0 0 280px;
    margin-right: 20px;
    scroll-snap-align: start;
}
    
    .review-card .card {
    height: 180px;
    border-radius: 15px;
    background: white;
    border: 1px solid #e9ecef;
    position: relative;
    overflow: hidden;
}

    
    .review-card .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(18, 22, 67, 0.1);
        border-color: #121643;
    }
    
    .review-card .card-body {
        padding: 1.5rem 1.25rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
        height: 100%;
    }
    
    /* Truncate or wrap names */
.review-card .card-title {
    color: #121643;
    font-size: 1rem;
    margin-bottom: 0.75rem;
    white-space: normal;
    word-break: break-word;
    overflow: hidden;
    text-overflow: ellipsis;
}
    
    .review-card .text-warning {
        margin-bottom: 1rem;
    }
    
    .review-card .text-warning i {
        font-size: 0.9rem;
        margin-right: 1px;
        color: #ffd700;
    }
    
    .review-card .card-text {
        font-size: 0.85rem;
        line-height: 1.4;
        color: #6c757d;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        line-clamp: 3;
        -webkit-box-orient: vertical;
    }
    
    /* Compact form styling */
    #hotel-reviews .card-header {
        background: white;
        color: #121643;
        border-bottom: 1px solid #e9ecef;
        padding: 1rem;
    }
    
    #hotel-reviews .card-header h5 {
        color: #121643;
        margin-bottom: 0.25rem;
    }
    
    #hotel-reviews .btn-primary {
        background: #121643;
        border: none;
        padding: 8px 20px;
        font-weight: 600;
        transition: all 0.3s ease;
        border-radius: 8px;
    }
    
    #hotel-reviews .btn-primary:hover {
        background: #0e123a;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(18, 22, 67, 0.2);
    }
    
    #hotel-reviews .form-control:focus,
    #hotel-reviews .form-select:focus {
        border-color: #121643;
        box-shadow: 0 0 0 0.2rem rgba(18, 22, 67, 0.15);
    }
    
    #hotel-reviews .form-label {
        color: #495057;
        font-size: 0.9rem;
    }
    
    /* Enhanced star rating dropdown */
    #id_rating option {
        padding: 8px;
        font-size: 0.95rem;
    }
    
    /* Responsive adjustments for smaller cards */
    @media (max-width: 768px) {
        .rooms-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        .hotel-hero-image {
            height: 300px;
        }
        
        .hotel-hero-content h1 {
            font-size: 2rem;
        }
        
        .room-image-container {
            height: 150px;
        }
        
        #hotel-reviews h2 {
            font-size: 2rem;
            margin-bottom: 2rem;
        }
        
        .review-card {
            flex: 0 0 250px;
            margin-right: 15px;
        }
        
        .review-card .card {
            height: 160px;
        }
        
        .review-card .card-body {
            padding: 1.25rem 1rem;
        }
        
        .review-card .card-title {
            font-size: 0.95rem;
        }
        
        .review-card .card-text {
            font-size: 0.8rem;
            -webkit-line-clamp: 2;
            line-clamp: 2;
        }
    }
    
    @media (max-width: 576px) {
        .hotel-hero-image {
            height: 250px;
        }
        
        .rooms-grid {
            gap: 0.75rem;
        }
        
        #hotel-reviews {
            padding: 3rem 0;
        }
        
        #hotel-reviews h2 {
            font-size: 1.8rem;
        }
        
        .review-card {
            flex: 0 0 220px;
            margin-right: 12px;
        }
        
        .review-card .card {
            height: 150px;
        }
        
        .review-card .card-body {
            padding: 1rem 0.875rem;
        }
        
        .review-card .text-warning i {
            font-size: 0.8rem;
        }
        
        .review-card .card-text {
            font-size: 0.75rem;
        }
        
        #hotel-reviews .btn-primary {
            padding: 10px 25px;
            font-size: 0.95rem;
        }
    }
    
    /* Filter animations */
    .room-item {
        transition: all 0.3s ease;
    }
    
    .room-item.hidden {
        display: none;
    }
    
    /* View toggle buttons */
    .btn-group .btn.active {
        background-color: #007bff;
        color: white;
        border-color: #007bff;
    }

    

/* About Section Styles */
#about-section .card {
    border: 1px solid #eee;
    border-radius: 8px;
}
#about-section .card-header {
    border-bottom: 1px solid #eee;
    padding: 1rem 1.5rem;
}
#about-section .card-body {
    padding: 1.5rem;
    background-color: #f8f9fa;
}
#about-section .see-more {
    color: #007bff;
    text-decoration: none;
    font-size: 0.9rem;
}
#about-section .see-more:hover {
    text-decoration: underline;
}
#about-section .amenities-content,
#about-section .policies-content {
    max-width: 100%;
    overflow: hidden;
}
#about-section .description-content p {
    margin-bottom: 0;
}
@media (max-width: 768px) {
    #about-section .card-body {
        padding: 1rem;
    }
    #about-section .row-cols-lg-4 {
        row-cols-md-2;
    }
    #about-section .see-more {
        font-size: 0.85rem;
    }
}
@media (max-width: 576px) {
    #about-section .row-cols-lg-4 {
        row-cols-2;
    }
    #about-section .card-header {
        padding: 0.75rem 1rem;
    }
}

.progress-bar.bg-orange {  /* For 2 stars */
    background-color: #fd7e14 !important;
}

/* Card Background Consistency */
.card.bg-light {
    background-color: #f8f9fa !important;
}

.review-item {
    width: 100%;  /* Full width */
    border: 1px solid #eee !important;  /* Border around each review */
    padding: 1rem !important;  /* Padding between reviews */
}
.reviews-list hr {
    display: none;  /* Remove extra hr */
}
.card.bg-light .card-body {
    background-color: #f8f9fa;  /* Ensure single color */
}

/* Progress Bar */
.rating-distribution {
    width: 100%;
    max-width: 500px;
}
.rating-distribution .progress {
    height: 12px;
    border-radius: 8px;
    overflow: hidden;
    width: 100%; /* Full width by default */
}
.rating-distribution .progress-bar {
    border-radius: 8px;
}
@media (max-width: 768px) {
    .rating-distribution .progress {
        width: 100%; /* Ensure full width on mobile */
    }
}

.gallery-img {
  width: 100%;
  height: 205px;
  object-fit: cover;
  aspect-ratio: 4/3; /* prevents portrait images from creating large gaps */
  border-radius: 8px;
}

.thumb-img {
  height: 120px;
  width: 100%;
  object-fit: cover;
  aspect-ratio: 4/3;
  border-radius: 6px;
}

.gallery-thumb img {
  transition: transform 0.3s ease;
}
.gallery-thumb:hover img {
  transform: scale(1.05);
}

/* Responsive: hide grid on mobile, show carousel */
@media (max-width: 767.98px) {
  .d-none.d-md-flex { display: none !important; }
  .d-md-none { display: block !important; }
}

#photosModal .modal-content {
  background-color: #000;
  border: none;
  border-radius: 0.75rem;
  overflow: hidden;
}

#photosModal img {
  max-width: 100%;
  max-height: 75vh;
  object-fit: contain;
}

#photosModal .carousel-control-prev-icon,
#photosModal .carousel-control-next-icon {
  filter: invert(1);
}
/* Ensure all grid images have consistent border-radius */
.hotel-grid-img {
  border-radius: 8px !important;
  object-fit: cover;
  width: 100%;
}

/* Universal fix for hotel image grids */
.hotel-grid-img,
.card.border-0.shadow-sm img,
.row.g-3 img {
  border-radius: 8px !important;
  object-fit: cover !important;
  aspect-ratio: 4 / 3 !important;
  width: 100%;
  height: auto;
  display: block;
}

/* Containers must clip corners */
.card.border-0.shadow-sm,
.row.g-3 > .col-6,
.row.g-3 > .col-12,
.col-lg-6 {
  overflow: hidden !important;
  border-radius: 8px !important;
}
/* Normalize portrait images to consistent visual height */
.row.g-3 img,
.hotel-grid-img {
  height: 100%;
  max-height: 420px;
  object-fit: cover;
}

/* Fallback for when height collapses on narrow aspect ratios */
@media (min-width: 768px) {
  .row.g-3 img {
    aspect-ratio: 4 / 3;
  }
}


/* Fix cards cutting radius */
.card.border-0.shadow-sm {
  border-radius: 8px !important;
  overflow: hidden !important;
}




/* Force-hide all desktop grid sections on mobile */
@media (max-width: 767.98px) {
  .desktop-grid-section,
  .row.g-3.align-items-start,
  .row.g-3,
  .d-md-flex {
    display: none !important;
  }
}


</style>

<!-- Consolidated inline JS: merged from multiple blocks to preserve execution order and avoid duplicate DOMContentLoaded handlers -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    // --- Toasts ---
    const successToastEl = document.getElementById('successToast');
    const errorToastEl = document.getElementById('errorToast');
    const successToast = successToastEl ? new bootstrap.Toast(successToastEl) : null;
    const errorToast = errorToastEl ? new bootstrap.Toast(errorToastEl) : null;

    {% if messages %}
        {% for message in messages %}
            {% if message.tags == 'success' %}
                if (successToast) successToast.show();
            {% elif message.tags == 'error' %}
                if (errorToast) {
                    document.getElementById('errorToastMessage').textContent = '{{ message }}';
                    errorToast.show();
                }
            {% endif %}
        {% endfor %}
    {% endif %}

    // --- Elements & Filters ---
    const roomsContainer = document.getElementById('rooms-container');
    const roomsCountEl = document.getElementById('rooms-count');
    const noResults = document.getElementById('no-results');

    const capacityFilterEl = document.getElementById('capacity-filter');
    const priceFilterEl = document.getElementById('price-filter');
    const availabilityFilterEl = document.getElementById('availability-filter');

    const gridBtn = document.getElementById('grid-view');
    const listBtn = document.getElementById('list-view');

    function filterRooms() {
        const capacityFilter = capacityFilterEl ? capacityFilterEl.value : '';
        const priceFilter = priceFilterEl ? priceFilterEl.value : '';
        const availabilityFilter = availabilityFilterEl ? availabilityFilterEl.value : '';

        const roomItems = document.querySelectorAll('.room-item');
        let visibleCount = 0;

        roomItems.forEach(item => {
            let show = true;

            if (capacityFilter) {
                const capacity = parseInt(item.dataset.capacity || '0', 10);
                const filterCapacity = parseInt(capacityFilter, 10);
                if (filterCapacity === 4 && capacity < 4) show = false;
                else if (filterCapacity !== 4 && capacity !== filterCapacity) show = false;
            }

            if (priceFilter) {
                const price = parseInt(item.dataset.price || '0', 10);
                if (priceFilter.includes('+')) {
                    const min = parseInt(priceFilter.replace('+', ''), 10);
                    if (price < min) show = false;
                } else {
                    const parts = priceFilter.split('-').map(p => parseInt(p.replace('+','') || '0', 10));
                    const min = parts[0], max = parts[1];
                    if (!isNaN(min) && !isNaN(max)) {
                        if (price < min || price > max) show = false;
                    }
                }
            }

            if (availabilityFilter && item.dataset.availability !== availabilityFilter) show = false;

            if (show) {
                item.style.display = '';
                item.classList.remove('hidden');
                visibleCount++;
            } else {
                item.style.display = 'none';
                item.classList.add('hidden');
            }
        });

        if (roomsCountEl) roomsCountEl.textContent = visibleCount;
        if (noResults) noResults.style.display = (visibleCount === 0) ? 'block' : 'none';
    }

    // --- See More (about & description) ---
    document.querySelectorAll('.see-more').forEach(button => {
        button.addEventListener('click', function (e) {
            e.preventDefault();
            const target = this.getAttribute('data-target');
            const fullContent = document.getElementById(`${target}-full`);
            const initialContent = document.getElementById(`${target}-initial`);
            const text = this.textContent;

            if (fullContent && initialContent) {
                if (text === 'See More') {
                    fullContent.classList.remove('d-none');
                    initialContent.classList.add('d-none');
                    this.textContent = 'See Less';
                } else {
                    fullContent.classList.add('d-none');
                    initialContent.classList.remove('d-none');
                    this.textContent = 'See More';
                }
            } else if (fullContent && !initialContent) {
                if (text === 'See More') {
                    fullContent.classList.remove('d-none');
                    const desc = document.getElementById('description-text');
                    if (desc) desc.classList.add('d-none');
                    this.textContent = 'See Less';
                } else {
                    fullContent.classList.add('d-none');
                    const desc = document.getElementById('description-text');
                    if (desc) desc.classList.remove('d-none');
                    this.textContent = 'See More';
                }
            }
        });
    });

    // --- See More Reviews (append remaining reviews) ---
    function attachSeeMoreReviewListeners(scope) {
        scope.querySelectorAll('.see-more-review').forEach(button => {
            button.addEventListener('click', function (e) {
                e.preventDefault();
                const fullText = this.getAttribute('data-full-text');
                const shortTextEl = this.previousElementSibling;
                const originalShortText = shortTextEl.dataset.originalText || shortTextEl.textContent;
                const text = this.textContent;

                if (text === 'See More') {
                    if (!shortTextEl.dataset.originalText) shortTextEl.dataset.originalText = originalShortText;
                    shortTextEl.textContent = fullText;
                    this.textContent = 'See Less';
                } else {
                    shortTextEl.textContent = originalShortText;
                    this.textContent = 'See More';
                }
            });
        });
    }

    attachSeeMoreReviewListeners(document);

    const seeMoreBtn = document.getElementById('see-more-reviews');
    if (seeMoreBtn) {
        seeMoreBtn.addEventListener('click', function () {
            const additionalReviews = document.createElement('div');
            additionalReviews.innerHTML = `
                {% for review in all_reviews %}
                    <div class="review-item border rounded p-3 mb-3 bg-white">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <h5 class="fw-semibold mb-0">{{ review.name }}</h5>
                            <span class="ms-2 badge" style="background-color: rgb(48, 152, 48); color: #fff; min-width: 48px; height: 32px; display: inline-flex; align-items: center; justify-content: center; font-size: 0.9rem; border-radius: 16px; padding: 0 10px;">
                                      {{ review.rating }}<i class="fas fa-star ms-1"></i>
                                    </span>
                        </div>
                        <small class="text-muted d-block mb-2">{{ review.created_at|date:"M d, Y" }}</small>
                        <p class="text-muted review-text-short">{{ review.review_text|truncatewords:30 }}</p>
                        
                        {% if review.review_text|wordcount > 30 %}
                            <button class="btn btn-link p-0 see-more-review" data-full-text="{{ review.review_text|safe }}">See More</button>
                        {% endif %}
                    </div>
                {% endfor %}
            `;
            document.querySelector('.reviews-list').appendChild(additionalReviews);
            this.style.display = 'none';
            attachSeeMoreReviewListeners(additionalReviews);
        });
    }

    // --- View toggle for rooms ---
    window.toggleView = function (viewType) {
        const roomItems = document.querySelectorAll('.room-item');
        if (!roomsContainer) return;

        if (viewType === 'grid') {
            roomsContainer.className = 'rooms-grid';
            if (gridBtn) gridBtn.classList.add('active');
            if (listBtn) listBtn.classList.remove('active');

            roomItems.forEach(item => {
                const gridCard = item.querySelector('.room-card-grid');
                const listCard = item.querySelector('.room-card-list');
                if (gridCard) gridCard.style.display = 'flex';
                if (listCard) listCard.style.display = 'none';
            });
        } else {
            roomsContainer.className = 'rooms-list';
            if (listBtn) listBtn.classList.add('active');
            if (gridBtn) gridBtn.classList.remove('active');

            roomItems.forEach(item => {
                const gridCard = item.querySelector('.room-card-grid');
                const listCard = item.querySelector('.room-card-list');
                if (gridCard) gridCard.style.display = 'none';
                if (listCard) listCard.style.display = 'block';
            });
        }

        filterRooms();
    };

    if (gridBtn) gridBtn.addEventListener('click', function (e) { e.preventDefault(); window.toggleView('grid'); });
    if (listBtn) listBtn.addEventListener('click', function (e) { e.preventDefault(); window.toggleView('list'); });

    [capacityFilterEl, priceFilterEl, availabilityFilterEl].forEach(el => {
        if (el) el.addEventListener('change', filterRooms);
    });

    window.toggleView('grid');
    filterRooms();

    const reviewForms = document.querySelectorAll('#reviewModal form, #hotel-reviews form');
    reviewForms.forEach(function(form) {
        form.addEventListener('submit', function() {
            const btn = form.querySelector('button[type="submit"]');
            if (btn) {
                btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Submitting...';
                btn.disabled = true;
            }
        });
    });

    // --- Navbar smooth scroll & active link ---
    document.querySelectorAll('nav.navbar .nav-link[href^="#"]').forEach(link => {
      link.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href');
        const targetSection = document.querySelector(targetId);
        if (targetSection) {
          targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          document.querySelectorAll('nav.navbar .nav-link').forEach(nav => nav.classList.remove('active'));
          this.classList.add('active');
        }
      });
    });

    // --- Gallery thumbs open modal and sync carousel ---
    (function attachGalleryThumbs() {
        const thumbs = document.querySelectorAll('.gallery-thumb');
        const carouselEl = document.getElementById('hotelPhotosCarousel');
        if (!carouselEl) return;
        const bsCarousel = bootstrap.Carousel.getOrCreateInstance(carouselEl);

        thumbs.forEach(thumb => {
            thumb.addEventListener('click', function () {
                const index = parseInt(this.getAttribute('data-index'), 10) || 0;
                const modal = new bootstrap.Modal(document.getElementById('photosModal'));
                modal.show();

                setTimeout(() => {
                    bsCarousel.to(index);
                }, 200);
            });
        });
    })();

    // --- Mobile carousel counter ---
    (function mobileCarouselCounter() {
        const carouselEl = document.getElementById('hotelMobileCarousel');
        if (!carouselEl) return;
        const counter = document.getElementById('carousel-counter');
        const carousel = new bootstrap.Carousel(carouselEl);

        carouselEl.addEventListener('slid.bs.carousel', function (e) {
          const index = e.to + 1;
          const total = {{ hotel_images.count }};
          if (counter) {
            counter.textContent = `${index} / ${total}`;
          }
        });
    })();

    // --- Gallery: reveal + overlay handling for "more" badges handled by markup via overlay - no extra JS required beyond carousel sync ---
});
</script>


{% endblock %} 