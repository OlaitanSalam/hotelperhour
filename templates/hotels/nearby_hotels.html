{% extends 'base2.html' %}

{% block content %}
<div class="container mt-5 mb-5">
    <h2>Nearby Hotels</h2>

    <!-- Radius Selection -->
    <form method="get" class="mb-3">
        <input type="hidden" name="lat" id="lat-field" value="{{ request.GET.lat }}">
        <input type="hidden" name="lng" id="lng-field" value="{{ request.GET.lng }}">
        <label for="radius" class="form-label">Search Radius:</label>
        <select name="radius" id="radius" class="form-select w-auto d-inline-block">
    {% for r in radius_options %}
        <option value="{{ r }}" {% if selected_radius == r %}selected{% endif %}>{{ r }} km</option>
    {% endfor %}
</select>

        <button type="submit" class="btn btn-primary btn-sm">Update</button>
    </form>

    {% if nearby_hotels %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Suburb/Area</th>
                    <th>Distance (km)</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for item in nearby_hotels %}
                    <tr>
                        <td>{{ item.hotel.get_public_name }}</td>
                        <td>{{ item.hotel.suburb|default:item.hotel.city }}</td>
                        <td>{{ item.distance|floatformat:2 }}</td>
                        <td>
                            <a href="{% url 'hotel_detail' item.hotel.slug %}" class="btn btn-primary btn-sm">View</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> No hotels found nearby. 
            Try selecting a larger radius or entering an address.
        </div>
    {% endif %}

    <!-- Pagination -->
{% include "pagination.html" with page_obj=nearby_hotels query_string=query_string %}


    <!-- Geolocation Script -->
    <script>
        if (!window.location.search.includes('lat') && !window.location.search.includes('lng')) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var lat = position.coords.latitude;
                    var lng = position.coords.longitude;
                    document.getElementById("lat-field").value = lat;
                    document.getElementById("lng-field").value = lng;
                    document.querySelector("form").submit();
                }, function(error) {
                    // Fallback: show message
                    const container = document.querySelector(".container");
                    const fallback = document.createElement("div");
                    fallback.className = "alert alert-warning mt-3";
                    fallback.innerHTML = "<i class='fas fa-map-marker-alt'></i> We couldn't detect your location. Please enter your address or select a city manually.";
                    container.prepend(fallback);
                });
            } else {
                alert("Geolocation is not supported by your browser.");
            }
        }
    </script>
</div>
{% endblock %}
